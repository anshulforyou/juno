<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-features/sync">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Juno is awesome 🌠 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Juno is awesome 🌠 Atom Feed"><title data-rh="true">Synchronization | Juno is awesome 🌠</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://gojuno.xyz/docs/features/sync"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Synchronization | Juno is awesome 🌠"><meta data-rh="true" name="description" content="There are currently two methods to synchronize with the StarkNet chain (i.e., download, hold, and update the StarkNet state):"><meta data-rh="true" property="og:description" content="There are currently two methods to synchronize with the StarkNet chain (i.e., download, hold, and update the StarkNet state):"><link data-rh="true" rel="icon" href="/img/juno_small.jpg"><link data-rh="true" rel="canonical" href="https://gojuno.xyz/docs/features/sync"><link data-rh="true" rel="alternate" href="https://gojuno.xyz/docs/features/sync" hreflang="en"><link data-rh="true" rel="alternate" href="https://gojuno.xyz/docs/features/sync" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.981189d4.css">
<link rel="preload" href="/assets/js/runtime~main.54000949.js" as="script">
<link rel="preload" href="/assets/js/main.288b8069.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/juno.svg" alt="Juno Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/juno.svg" alt="Juno Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Juno</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/NethermindEth/juno" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/getting-started">Getting Started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Welcome</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/contribution-guidelines">Contribution Guidelines</a><button aria-label="Toggle the collapsible sidebar category &#x27;Contribution Guidelines&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/future-implementations">Future Implementations</a><button aria-label="Toggle the collapsible sidebar category &#x27;Future Implementations&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/running">Running</a><button aria-label="Toggle the collapsible sidebar category &#x27;Running&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/features">Features</a><button aria-label="Toggle the collapsible sidebar category &#x27;Features&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/features/cryptography">Cryptographic basis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/features/database">Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/features/feeder-gateway">Feeder Gateway Connection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/features/merkle-tree">Merkle Tries Details</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/features/metrics">Juno Metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/features/rpc">RPC Server</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/features/sync">Synchronization</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/testing">Testing</a><button aria-label="Toggle the collapsible sidebar category &#x27;Testing&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/features"><span itemprop="name">Features</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Synchronization</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Synchronization</h1></header><p>There are currently two methods to synchronize with the StarkNet chain (i.e., download, hold, and update the StarkNet state):</p><ol><li>The StarkWare feeder gateway (a centralized API provided by StarkWare) or</li><li>The Layer 1 StarkNet contracts on the Ethereum chain (these contracts hold the StarkNet data on-chain,
<a href="https://docs.starknet.io/docs/Data%20Availabilty/on-chain-data" target="_blank" rel="noopener noreferrer">providing data availability</a>).</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="api-syncing">API syncing<a class="hash-link" href="#api-syncing" title="Direct link to heading">​</a></h2><p>The syncing process with the feeder gateway is relatively simple: request a state update from the API <a href="https://alpha-mainnet.starknet.io/feeder_gateway/get_state_update?blockNumber=0" target="_blank" rel="noopener noreferrer">like this</a>
and apply that state update to the local database.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="layer-1-syncing">Layer 1 Syncing<a class="hash-link" href="#layer-1-syncing" title="Direct link to heading">​</a></h2><p>Syncing with the L1 contracts is more complicated. To do this, we listen for events emitted by the contracts to reconstruct the StarkNet state update.</p><p>The three key StarkNet contracts on L1 that we are interested in are:</p><ol><li>MemoryPageFactRegistry: stores a mapping between a fact (a hash of some data) and a memory page hash.
This contract has an external function <code>registerMemoryPageContinuous</code> that accepts memory pages as input (data structure that contains L2 transaction data).
When it receives a new valid memory page, the <code>LogMemoryPageFactContinuous</code> event is emitted with the hash of the registered memory page.</li><li>GpsStatementVerifier: verifies proofs from layer 2.
When this contract verifies a proof, it emits a <code>LogMemoryPagesHashes</code> event, which contains a fact (hash of data used in the verification process) and an array of memory page hashes.</li><li>Starknet: transitions the StarkNet state.
Emits a <code>LogStateTransitionFact</code> event with a fact corresponding to the state transition being processed.
Once it completes additional safety checks, it will officially transition the state and emit a <code>LogStateUpdate</code> event with the new state root and Starknet block number (sequence number).</li></ol><p>When syncing against L1, we need to work backwards through the above steps to reconstruct the original state update.</p><p>Since we cannot rely on receiving the events in chronological order, we hold three mappings to keep the information straight (one for each contract):</p><ol><li>memoryPage: memoryPageHash -&gt; hash of the Ethereum transaction where the <code>LogMemoryPageFactContinuous</code> event was emitted.</li><li>gpsVerifier: fact1 -&gt; list of memory page hashes</li><li>facts: sequence number -&gt; fact (this fact is from <code>LogStateTransitionFact</code>, sequence number is from <code>LogStateUpdate</code>)</li></ol><p>To sync, we follow these steps:</p><ol><li>Once we see a <code>LogStateTransitionFact</code> event, we look for a <code>LogStateUpdate</code> in the same Ethereum block. If found, we add it to the third mapping above.
If the sequence number (StarkNet block number) is one greater than the latest sequence number of the last block we synced, we begin processing the state update.</li><li>Use the fact from the <code>LogStateTransitionFact</code> event to get the list of corresponding memory page hashes from the gpsVerifier mapping.</li><li>For each memory page hash, use the memoryPage mapping to find the hash of the transaction where the memory page data was sent.</li><li>Query an Ethereum node for the actual transaction using the transaction hash.</li><li>Parse the Ethereum transaction calldata to reconstruct the StarkNet state update.</li></ol><p>Further exploration:</p><ol><li><a href="https://docs.starknet.io/docs/State/starknet-state" target="_blank" rel="noopener noreferrer">StarkNet State</a> - layout of the StarkNet state trie</li><li><a href="https://ethresear.ch/t/batching-proofs-for-several-dapps-into-a-single-succinct-proof/5694" target="_blank" rel="noopener noreferrer">Fact registry design</a> - the reasoning behind the StarkNet L1 contract architecture</li><li><a href="https://github.com/starkware-libs/starkex-contracts/tree/master/evm-verifier" target="_blank" rel="noopener noreferrer">StarkEx contracts on GitHub</a> - contain initial implementations of the MemoryPageFactRegistry and GpsStatementVerifier contracts for StarkEx</li><li><a href="https://goerli.etherscan.io/address/0x5e6229F2D4d977d20A50219E521dE6Dd694d45cc#code" target="_blank" rel="noopener noreferrer">StarkNet contract on Goerli</a> (may be out of date by the time you&#x27;re reading this)</li><li><a href="https://eprint.iacr.org/2021/1063" target="_blank" rel="noopener noreferrer">Cairo white paper</a> - useful background knowledge to have while reading the above contracts</li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/NethermindEth/juno/tree/main/docs/docs/features/sync.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/features/rpc"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">RPC Server</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/category/testing"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Testing</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#api-syncing" class="table-of-contents__link toc-highlight">API syncing</a></li><li><a href="#layer-1-syncing" class="table-of-contents__link toc-highlight">Layer 1 Syncing</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/sqFY2D48GS" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://nethermind.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Nethermind<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Juno. Made with ❤️ by Nethermind.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.54000949.js"></script>
<script src="/assets/js/main.288b8069.js"></script>
</body>
</html>